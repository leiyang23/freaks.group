{"version":3,"sources":["webpack:///./src/views/monitor/Terminal.vue?b0bf","webpack:///./src/views/monitor/Terminal.vue?a429","webpack:///src/views/monitor/Terminal.vue","webpack:///./src/views/monitor/Terminal.vue?4892","webpack:///./src/views/monitor/Terminal.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","directives","name","rawName","value","expression","attrs","domProps","on","$event","target","composing","con","nativeOn","type","indexOf","_k","keyCode","key","ws_send","model","callback","$$v","send_message","dialogVisible","_v","handleClose","conn_info","$set","slot","iconName","init_conn","staticRenderFns","component"],"mappings":"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","file":"js/chunk-1928dacd.20f29626.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Terminal.vue?vue&type=style&index=0&id=17b37a62&scoped=true&lang=less&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Terminal.vue?vue&type=style&index=0&id=17b37a62&scoped=true&lang=less&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page\"},[_c('div',{staticClass:\"shell\"},[_c('div',{staticClass:\"txt\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.con),expression:\"con\"}],attrs:{\"id\":\"shell\",\"readonly\":\"\"},domProps:{\"value\":(_vm.con)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.con=$event.target.value}}})]),_c('div',{staticClass:\"ipt\"},[(_vm.conn_status)?_c('el-input',{staticClass:\"input\",attrs:{\"placeholder\":\"按回车键发送命令\"},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.ws_send($event)}},model:{value:(_vm.send_message),callback:function ($$v) {_vm.send_message=$$v},expression:\"send_message\"}}):_c('el-button',{on:{\"click\":function($event){_vm.dialogVisible=true}}},[_vm._v(\"连接\")])],1)]),_c('el-dialog',{attrs:{\"title\":\"连接到远程机器\",\"close-on-click-modal\":false,\"close-on-press-escape\":false,\"show-close\":true,\"center\":true,\"visible\":_vm.dialogVisible,\"width\":\"30%\",\"before-close\":_vm.handleClose},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('el-form',{attrs:{\"model\":_vm.conn_info}},[_c('el-form-item',{attrs:{\"label\":\"IP\",\"label-width\":\"100px\"}},[_c('el-input',{attrs:{\"autocomplete\":\"off\"},model:{value:(_vm.conn_info.host),callback:function ($$v) {_vm.$set(_vm.conn_info, \"host\", $$v)},expression:\"conn_info.host\"}})],1),_c('el-form-item',{attrs:{\"label\":\"端口\",\"label-width\":\"100px\"}},[_c('el-input',{attrs:{\"autocomplete\":\"off\"},model:{value:(_vm.conn_info.port),callback:function ($$v) {_vm.$set(_vm.conn_info, \"port\", $$v)},expression:\"conn_info.port\"}})],1),_c('el-form-item',{attrs:{\"label\":\"用户名\",\"label-width\":\"100px\"}},[_c('el-input',{attrs:{\"autocomplete\":\"off\"},model:{value:(_vm.conn_info.username),callback:function ($$v) {_vm.$set(_vm.conn_info, \"username\", $$v)},expression:\"conn_info.username\"}})],1),_c('el-form-item',{attrs:{\"label\":\"密码\",\"label-width\":\"100px\"}},[_c('el-input',{attrs:{\"autocomplete\":\"off\"},model:{value:(_vm.conn_info.password),callback:function ($$v) {_vm.$set(_vm.conn_info, \"password\", $$v)},expression:\"conn_info.password\"}})],1)],1),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"icon\":_vm.iconName},on:{\"click\":_vm.init_conn}},[_vm._v(\"连接\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"page\">\r\n    <div class=\"shell\">\r\n      <div class=\"txt\">\r\n        <textarea id=\"shell\" v-model=\"con\" readonly></textarea>\r\n      </div>\r\n\r\n      <div class=\"ipt\">\r\n        <el-input v-if=\"conn_status\" @keyup.enter.native=\"ws_send\" v-model=\"send_message\" class=\"input\"\r\n                  placeholder=\"按回车键发送命令\"></el-input>\r\n        <el-button v-else @click=\"dialogVisible=true\">连接</el-button>\r\n        <!--        <el-autocomplete @keyup.enter.native=\"ws_send\"-->\r\n        <!--                         @keyup.up.native=\"previous\"-->\r\n        <!--                         v-model=\"send_message\"-->\r\n        <!--                         :fetch-suggestions=\"querySearch\"-->\r\n        <!--                         :disabled=\"is_disabled\"-->\r\n        <!--                         class=\"input\"-->\r\n        <!--                         @select=\"handleSelect\"></el-autocomplete>-->\r\n        <!--        <el-button type=\"primary\" @click=\"ws_send\">发送</el-button>-->\r\n      </div>\r\n    </div>\r\n\r\n    <el-dialog\r\n            title=\"连接到远程机器\"\r\n            :close-on-click-modal=\"false\"\r\n            :close-on-press-escape=\"false\"\r\n            :show-close=\"true\"\r\n            :center=\"true\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"30%\"\r\n            :before-close=\"handleClose\">\r\n      <el-form :model=\"conn_info\">\r\n        <el-form-item label=\"IP\" label-width=\"100px\">\r\n          <el-input v-model=\"conn_info.host\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"端口\" label-width=\"100px\">\r\n          <el-input v-model=\"conn_info.port\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"用户名\" label-width=\"100px\">\r\n          <el-input v-model=\"conn_info.username\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"密码\" label-width=\"100px\">\r\n          <el-input v-model=\"conn_info.password\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n<!--        <el-button @click=\"dialogVisible = false\">取 消</el-button>-->\r\n        <el-button type=\"primary\" @click=\"init_conn\" :icon=\"iconName\">连接</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n    import {WS_BASE_URL} from '../../conf'\r\n\r\n    export default {\r\n        name: \"Terminal\",\r\n        data() {\r\n            return {\r\n                input_history: [],\r\n                iconName: \"\",\r\n                socket: \"\",\r\n                ws_path: WS_BASE_URL + '/ws/monitor/terminal',\r\n                send_message: '',\r\n                con: \"\",\r\n                conn_status: false,\r\n                dialogVisible: true,\r\n                conn_info: {\r\n                    \"host\": \"47.111.175.222\",\r\n                    \"port\": 22,\r\n                    \"username\": \"root\",\r\n                    \"password\": \"1005931665Ecs\"\r\n                },\r\n\r\n            }\r\n        },\r\n        mounted() {\r\n            this.init();\r\n            let that = this;\r\n            let count = 0;\r\n            let timer = setInterval(function () {\r\n                if (that.socket.readyState !== 1) {\r\n                    that.init();\r\n                    count++;\r\n                    if (count > 3) {\r\n                        clearInterval(timer)\r\n                    }\r\n                } else {\r\n                    clearInterval(timer)\r\n                }\r\n            }, 15000)\r\n        },\r\n        methods: {\r\n            handleClose(done) {\r\n                this.$message.error(\"未连接！\");\r\n                done()\r\n            },\r\n            init_conn() {\r\n                this.iconName = \"el-icon-loading\";\r\n                this.socket.send(JSON.stringify({\r\n                    \"conn_info\": this.conn_info,\r\n                    \"message\": \"init_conn\"\r\n                }));\r\n            },\r\n            previous() {\r\n                this.send_message = this.input_history[0]\r\n            },\r\n            querySearch(queryString, cb) {\r\n                let data = [];\r\n                for (let i = 0; i < this.input_history.length; i++) {\r\n                    data.push({\r\n                        value: this.input_history[i]\r\n                    })\r\n                }\r\n                cb(data)\r\n            },\r\n            handleSelect(item) {\r\n                this.send_message = item.value;\r\n                this.ws_send()\r\n            },\r\n            scroll_to_bottom() {\r\n                let textarea = document.getElementById('shell');\r\n                textarea.scrollTop = textarea.scrollHeight;\r\n            },\r\n            init() {\r\n                if (typeof (WebSocket) === \"undefined\") {\r\n                    this.$message.error(\"浏览器不支持 websocket !\")\r\n                } else {\r\n                    this.socket = new WebSocket(this.ws_path);\r\n                    this.socket.onopen = this.ws_open;\r\n                    // 监听socket错误信息\r\n                    this.socket.onerror = this.ws_error;\r\n                    // 监听socket消息\r\n                    this.socket.onmessage = this.ws_get_message;\r\n\r\n                    this.socket.onclose = this.ws_close;\r\n\r\n                }\r\n            },\r\n            ws_open() {\r\n                window.console.log(\"conn success\");\r\n                // this.is_disabled = false;\r\n            },\r\n            ws_error() {\r\n                window.console.log(\"conn err\");\r\n                this.conn_status = false;\r\n                this.$notify.error({\r\n                    title: \"错误\",\r\n                    message: '连接出现错误！',\r\n                    duration: 3000\r\n                })\r\n            },\r\n            ws_get_message(msg) {\r\n                // window.console.log(msg);\r\n                let that = this;\r\n                let resp = JSON.parse(msg.data);\r\n                // window.console.log(resp);\r\n\r\n                // 只有第一次连接验证信息时会返回 status 字段，\r\n                if (\"status\" in resp) {\r\n                    if (resp.status === \"bad\") {\r\n                        that.iconName = \"\";\r\n                        that.dialogVisible = true;\r\n                        that.$message.error(resp.message);\r\n                        return\r\n                    } else if (resp.status === \"ok\") {\r\n                        that.conn_status = true;\r\n                        that.dialogVisible = false;\r\n                        that.$message.success(resp.message);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n                this.con = this.con + resp.message;\r\n                setTimeout(function () {\r\n                    that.scroll_to_bottom();\r\n                }, 200)\r\n            },\r\n            ws_close() {\r\n                window.console.warn(\"conn close\");\r\n                this.conn_status = false;\r\n            },\r\n            ws_send() {\r\n\r\n                this.socket.send(JSON.stringify({\r\n                    message: this.send_message\r\n                }));\r\n                this.input_history.unshift(this.send_message);\r\n                if (this.input_history.length > 5) {\r\n                    this.input_history.pop()\r\n                }\r\n                this.send_message = '';\r\n            }\r\n        },\r\n        destroyed() {\r\n            this.socket.close();\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .shell {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n\r\n    .txt {\r\n      height: 600px;\r\n      width: 800px;\r\n      margin-bottom: 20px;\r\n\r\n      textarea {\r\n        width: 100%;\r\n        height: 100%;\r\n        padding:0;\r\n        border: none;\r\n        background-color: #263f44;\r\n        color: #e4f9ff;\r\n        line-height: 20px;\r\n        font-family: sans-serif, \"Times New Roman\", Georgia, Serif;\r\n\r\n      }\r\n    }\r\n\r\n    .ipt {\r\n      display: flex;\r\n      flex-direction: row;\r\n      align-items: center;\r\n\r\n      .input {\r\n        width: 800px;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Terminal.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Terminal.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Terminal.vue?vue&type=template&id=17b37a62&scoped=true&\"\nimport script from \"./Terminal.vue?vue&type=script&lang=js&\"\nexport * from \"./Terminal.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Terminal.vue?vue&type=style&index=0&id=17b37a62&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"17b37a62\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}